{% extends "base.html" %}
{% block title %}Оплата тарифа - GSHVPN{% endblock %}
{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm mt-4">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h2 class="fw-bold">Оплата тарифа</h2>
                        <p class="text-muted">
                            Тариф: 
                            <strong>
                                {% if order.plan == 'free' %}
                                    Бесплатно
                                {% elif order.plan == '1m' %}
                                    1 месяц
                                {% else %}
                                    3 месяца
                                {% endif %}
                            </strong>
                        </p>
                        <div class="price-display">
                            <span class="h3 text-primary fw-bold">${{ order.amount_usd }}</span>
                        </div>
                    </div>
                    
                    {% if order.amount_usd > 0 %}
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Способ оплаты</label>
                            <div class="payment-methods">
                                <div class="form-check payment-option">
                                    <input class="form-check-input" type="radio" name="gw" id="gw-stripe" 
                                           {% if gateway=='stripe' or not gateway %}checked{% endif %} 
                                           onchange="location='?gateway=stripe'">
                                    <label class="form-check-label d-flex align-items-center" for="gw-stripe">
                                        <i class="fab fa-stripe me-2 text-primary fs-5"></i>
                                        <div>
                                            <div class="fw-semibold">Stripe</div>
                                            <small class="text-muted">Банковские карты, PayPal</small>
                                        </div>
                                    </label>
                                </div>
                                
                                <div class="form-check payment-option">
                                    <input class="form-check-input" type="radio" name="gw" id="gw-ck" 
                                           {% if gateway=='cloudkassir' %}checked{% endif %} 
                                           onchange="location='?gateway=cloudkassir'">
                                    <label class="form-check-label d-flex align-items-center" for="gw-ck">
                                        <i class="fas fa-credit-card me-2 text-success fs-5"></i>
                                        <div>
                                            <div class="fw-semibold">CloudKassir</div>
                                            <small class="text-muted">Россия/СНГ, рубли</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                    {% if order.amount_usd == 0 %}
                        <div class="alert alert-success">
                            <i class="fas fa-gift me-2"></i>
                            Бесплатный тариф! Нажмите кнопку ниже, чтобы получить ключ доступа.
                        </div>
                        
                        <form method="post" action="{{ url_for('billing.process_payment') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-key me-2"></i>
                                Получить ключ доступа
                            </button>
                        </form>
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Демо-режим:</strong> Это тестовая среда. Нажмите «Оплатить», чтобы смоделировать успешный платёж.
                        </div>
                        
                        <form method="post" action="{{ url_for('billing.process_payment') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-credit-card me-2"></i>
                                Оплатить ${{ order.amount_usd }}
                            </button>
                        </form>
                    {% endif %}
                    
                    <div class="mt-4 text-center">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            Безопасная оплата. Ваши данные защищены.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.payment-option {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.payment-option:has(input:checked) {
    border-color: var(--bs-primary);
    background: rgba(124, 58, 237, 0.05);
}

.payment-option:hover {
    border-color: var(--bs-primary);
}

.price-display {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
}
</style>
{% endblock %}
